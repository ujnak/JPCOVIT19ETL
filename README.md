# COVID-19のオープンデータをOracle Databaseに取り込むスクリプト群

Code for Japanが作成している「新型コロナウイルス感染症対策に関するオープンデータ項目定義書」の陽性患者属性の定義にしたがって作成した表に、各都道府県が公開しているデータをOracle Databaseに取り込むPL/SQLスクリプト群

## はじめに

陽性患者属性のデータは各都道府県がぞれぞれ異なったフォーマットで公開しています。これを同じ表に取り込むことで扱いを容易にします。Oracle DatabaseとOracle APEXが提供する機能を使用しています。

### 必要な環境

インターネットにつながるOracle DatabaseにOracle APEXがインストールされた環境が必要です。無料で取得可能な https://apex.oracle.com のワークスペースまたは、Oracle Cloudで提供されているAlways Freeとして永年無料で利用可能なインスタンスも使用できます。

### 利用方法

共通で利用する表定義やファンクションをデータベースに作成するSQLを実行します。それ以外は、都道府県別のスクリプトを実行し、データを取り込むために使用するファンクションやプロシージャーを作成します。

データの表示とアップデートを行うAPEXアプリケーション(viewerapp.sql)と管理を行うアプリケーション(manageapp.sql)、および、CSV、JSONでデータを提供するORDSのRESTサービス(restservice.sql)を含んでいます。

### 実行例

東京都の全国地方公共団体コードは130001です。陽性患者のデータであるCSVファイルは、ネットからURLを指定することでダウンロードできます。そのURLを指定します。

呼び出しは以下の形式になります。
```
begin
    update_patients(
        130001,
        'https://stopcovid19.metro.tokyo.lg.jp/data/130001_tokyo_covid19_patients.csv',
        0
    );
end;
```

群馬県、千葉県、新潟県、新潟県、岐阜県、山口県、宮崎県、沖縄県は、Convertio.ioのサービスを使用して、PDFファイルをXLSX形式に変換した後に読み込むます。変換したXLSXファイルをCOVID19_MUNICIPALITIES表のCONTENT_BLOB列にロードした後、それぞれの都道府県用のアップデート・プロシージャを実行します。

沖縄を例にとると、以下の呼び出し形式になります。
```
begin
    update_patients_okinawa(
        470007,
        null,
        1
    );
end;

上記の引数だけが与えるべき引数なので、すべて省略可能です。省略時の呼び出し形式は以下になります。
```
begin
    update_patients_okinawa;
end;
```

### 免責事項

それぞれの都道府県が公開している、新型コロナウイルス感染者の情報をできるだけそのまま取り込んでいますが、必ずしも一致していることは保証したしません。必ずデータの提供元である、各自治体の情報を参照してください。本データの利用によって生じた、あらゆる損害等に関して開発者は一切の責任を負いません。
